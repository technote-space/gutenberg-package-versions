#!/usr/bin/env bash

set -e

if [[ -z "${TRAVIS_BUILD_DIR}" ]]; then
	echo "<TRAVIS_BUILD_DIR> is required"
	exit 1
fi

WORK_DIR=${TRAVIS_BUILD_DIR}/.work
DATA_DIR=${TRAVIS_BUILD_DIR}/data
SCRIPT_DIR=${TRAVIS_BUILD_DIR}/travis-ci/bin

GUTENBERG_VARIABLE_PREFIX=GUTENBERG
GUTENBERG_SLUG=gutenberg
GUTENBERG_NAME=Gutenberg
GUTENBERG_REPO=WordPress/gutenberg
GUTENBERG_IS_WP=""

WP_VARIABLE_PREFIX=WP
WP_SLUG=wp-core
WP_NAME=WordPress
WP_REPO=WordPress/wordpress-develop
WP_IS_WP="TRUE"

GH_PAGES_DIR=${TRAVIS_BUILD_DIR}/gh-pages
GH_PAGES_CNAME=api.wp-framework.dev
GH_PAGES_API_ROOT=api
GH_PAGES_API_VERSION=v1

TAG_MESSAGE="Auto tag by Travis CI"
if [[ -n "${TRAVIS_BUILD_WEB_URL}" ]]; then
	COMMIT_MESSAGE="feat: Update version data (Travis build: ${TRAVIS_BUILD_WEB_URL})"
else
	COMMIT_MESSAGE="feat: Update version data"
fi

if [[ $# -ge 1 ]]; then
	PREFIX=${1}

	NAME=${PREFIX}_SLUG
	TARGET_SLUG=${!NAME}

	NAME=${PREFIX}_NAME
	TARGET_NAME=${!NAME}

	TARGET_WORK_REPO_DIR=${WORK_DIR}/repo/${TARGET_SLUG}
	TARGET_WORK_TAG_DIR=${WORK_DIR}/tags/${TARGET_SLUG}

	TARGET_PUBLISH_DIR=${DATA_DIR}/${TARGET_SLUG}
	TARGET_PUBLISH_TAGS_DIR=${TARGET_PUBLISH_DIR}/tags
	TARGET_PUBLISH_TAGS_FILE=${TARGET_PUBLISH_DIR}/tags.json
	TARGET_PUBLISH_VERSION_FILE=${TARGET_PUBLISH_DIR}/versions.json

	NAME=${PREFIX}_REPO
	TARGET_REPO=${!NAME}

	NAME=${PREFIX}_IS_WP
	TARGET_IS_WP=${!NAME}
fi
