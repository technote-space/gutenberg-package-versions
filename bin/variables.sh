#!/usr/bin/env bash

set -e

if [[ -z "${TRAVIS_BUILD_DIR}" ]]; then
	echo "<TRAVIS_BUILD_DIR> is required"
	exit 1
fi

WORK_DIR=${TRAVIS_BUILD_DIR}/.work
DATA_DIR=${TRAVIS_BUILD_DIR}/data

GUTENBERG_VARIABLE_PREFIX=GUTENBERG
GUTENBERG_SLUG=gutenberg
GUTENBERG_NAME=Gutenberg
GUTENBERG_DIR=${WORK_DIR}/${GUTENBERG_SLUG}
GUTENBERG_TAG_DIR=${WORK_DIR}/tags/${GUTENBERG_SLUG}
GUTENBERG_VERSION_DIR=${DATA_DIR}/${GUTENBERG_SLUG}
GUTENBERG_VERSION_FILE=${DATA_DIR}/gutenberg-versions.json
GUTENBERG_REPO=WordPress/gutenberg
GUTENBERG_IS_WP=""

WP_VARIABLE_PREFIX=WP
WP_SLUG=wordpress
WP_NAME=WordPress
WP_DIR=${WORK_DIR}/${WP_SLUG}
WP_TAG_DIR=${WORK_DIR}/tags/${WP_SLUG}
WP_VERSION_DIR=${DATA_DIR}/${WP_SLUG}
WP_VERSION_FILE=${DATA_DIR}/wp-versions.json
WP_REPO=WordPress/wordpress-develop
WP_IS_WP="TRUE"

TAG_MESSAGE="Auto tag by Travis CI"
if [[ -n "${TRAVIS_BUILD_NUMBER}" ]]; then
	COMMIT_MESSAGE="feat: Update version data (Travis build: ${TRAVIS_BUILD_WEB_URL})"
else
	COMMIT_MESSAGE="feat: Update version data"
fi

if [[ $# -ge 1 ]]; then
	PREFIX=${1}

	NAME=${PREFIX}_NAME
	TARGET_NAME=${!NAME}

	NAME=${PREFIX}_DIR
	TARGET_DIR=${!NAME}

	NAME=${PREFIX}_TAG_DIR
	TARGET_TAG_DIR=${!NAME}

	NAME=${PREFIX}_VERSION_DIR
	TARGET_VERSION_DIR=${!NAME}

	NAME=${PREFIX}_VERSION_FILE
	TARGET_VERSION_FILE=${!NAME}

	NAME=${PREFIX}_REPO
	TARGET_REPO=${!NAME}

	NAME=${PREFIX}_IS_WP
	TARGET_IS_WP=${!NAME}
fi
